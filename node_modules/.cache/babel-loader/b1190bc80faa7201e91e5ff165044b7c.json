{"ast":null,"code":"import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";import React,{useEffect}from\"react\";import{resetCameraImage,selectCameraImage}from\"./features/cameraSlice\";import{useSelector,useDispatch}from\"react-redux\";import\"./Preview.css\";import{useHistory}from\"react-router-dom\";import CloseIcon from\"@material-ui/icons/Close\";import CreateIcon from\"@material-ui/icons/Create\";import TextFieldsIcon from\"@material-ui/icons/TextFields\";import NoteIcon from\"@material-ui/icons/Note\";import MusicNoteIcon from\"@material-ui/icons/MusicNote\";import AttachFileIcon from\"@material-ui/icons/AttachFile\";import CropIcon from\"@material-ui/icons/Crop\";import TimerIcon from\"@material-ui/icons/Timer\";import SendIcon from\"@material-ui/icons/Send\";import{v4 as uuid}from\"uuid\";import{db,storage}from\"./firebase\";import firebase from\"firebase\";import{selectUser}from\"./features/appSlice\";function Preview(){var cameraImage=useSelector(selectCameraImage);var history=useHistory();var dispatch=useDispatch();var user=useSelector(selectUser);useEffect(function(){if(!cameraImage){history.replace(\"/capture\");}},[cameraImage,history]);var closePreview=function closePreview(){dispatch(resetCameraImage());};var sendPost=function sendPost(){var id=uuid();var uploadTask=storage.ref(\"posts/\".concat(id)).putString(cameraImage,\"data_url\");uploadTask.on(\"state_changed\",null,function(error){console.log(error);},function(){storage.ref(\"posts\").child(id).getDownloadURL().then(function(url){db.collection(\"posts\").add({imageUrl:url,username:user.username,read:[],profilePic:user.profilePic,timestamp:firebase.firestore.FieldValue.serverTimestamp()});history.replace(\"/\");});});};return/*#__PURE__*/_jsxs(\"div\",{className:\"preview\",children:[/*#__PURE__*/_jsx(CloseIcon,{className:\"preview__close\",onClick:closePreview}),/*#__PURE__*/_jsxs(\"div\",{className:\"preview__toolbarRight\",children:[/*#__PURE__*/_jsx(TextFieldsIcon,{}),/*#__PURE__*/_jsx(CreateIcon,{}),/*#__PURE__*/_jsx(NoteIcon,{}),/*#__PURE__*/_jsx(MusicNoteIcon,{}),/*#__PURE__*/_jsx(AttachFileIcon,{}),/*#__PURE__*/_jsx(CropIcon,{}),/*#__PURE__*/_jsx(TimerIcon,{})]}),/*#__PURE__*/_jsx(\"img\",{src:cameraImage,alt:\"\"}),/*#__PURE__*/_jsxs(\"div\",{onClick:sendPost,className:\"preview__footer\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Envoyer\"}),/*#__PURE__*/_jsx(SendIcon,{className:\"preview__sendIcon\"})]})]});}export default Preview;","map":{"version":3,"sources":["C:/Users/SEBASTIEN/Desktop/Exercices Web/React/Projets/Snapchat/snapchat/src/Preview.js"],"names":["React","useEffect","resetCameraImage","selectCameraImage","useSelector","useDispatch","useHistory","CloseIcon","CreateIcon","TextFieldsIcon","NoteIcon","MusicNoteIcon","AttachFileIcon","CropIcon","TimerIcon","SendIcon","v4","uuid","db","storage","firebase","selectUser","Preview","cameraImage","history","dispatch","user","replace","closePreview","sendPost","id","uploadTask","ref","putString","on","error","console","log","child","getDownloadURL","then","url","collection","add","imageUrl","username","read","profilePic","timestamp","firestore","FieldValue","serverTimestamp"],"mappings":"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","sourcesContent":["import React, { useEffect } from \"react\";\r\nimport { resetCameraImage, selectCameraImage } from \"./features/cameraSlice\";\r\nimport { useSelector, useDispatch } from \"react-redux\";\r\nimport \"./Preview.css\";\r\nimport { useHistory } from \"react-router-dom\";\r\nimport CloseIcon from \"@material-ui/icons/Close\";\r\nimport CreateIcon from \"@material-ui/icons/Create\";\r\nimport TextFieldsIcon from \"@material-ui/icons/TextFields\";\r\nimport NoteIcon from \"@material-ui/icons/Note\";\r\nimport MusicNoteIcon from \"@material-ui/icons/MusicNote\";\r\nimport AttachFileIcon from \"@material-ui/icons/AttachFile\";\r\nimport CropIcon from \"@material-ui/icons/Crop\";\r\nimport TimerIcon from \"@material-ui/icons/Timer\";\r\nimport SendIcon from \"@material-ui/icons/Send\";\r\nimport { v4 as uuid } from \"uuid\";\r\nimport { db, storage } from \"./firebase\";\r\nimport firebase from \"firebase\";\r\nimport { selectUser } from \"./features/appSlice\";\r\n\r\nfunction Preview() {\r\n  const cameraImage = useSelector(selectCameraImage);\r\n  const history = useHistory();\r\n  const dispatch = useDispatch();\r\n  const user = useSelector(selectUser);\r\n\r\n  useEffect(() => {\r\n    if (!cameraImage) {\r\n      history.replace(\"/capture\");\r\n    }\r\n  }, [cameraImage, history]);\r\n\r\n  const closePreview = () => {\r\n    dispatch(resetCameraImage());\r\n  };\r\n\r\n  const sendPost = () => {\r\n    const id = uuid();\r\n    const uploadTask = storage\r\n      .ref(`posts/${id}`)\r\n      .putString(cameraImage, \"data_url\");\r\n    uploadTask.on(\r\n      \"state_changed\",\r\n      null,\r\n      (error) => {\r\n        console.log(error);\r\n      },\r\n      () => {\r\n        storage\r\n          .ref(\"posts\")\r\n          .child(id)\r\n          .getDownloadURL()\r\n          .then((url) => {\r\n            db.collection(\"posts\").add({\r\n              imageUrl: url,\r\n              username: user.username,\r\n              read: [],\r\n              profilePic: user.profilePic,\r\n              timestamp: firebase.firestore.FieldValue.serverTimestamp(),\r\n            });\r\n            history.replace(\"/\");\r\n          });\r\n      }\r\n    );\r\n  };\r\n\r\n  return (\r\n    <div className=\"preview\">\r\n      <CloseIcon className=\"preview__close\" onClick={closePreview} />\r\n      <div className=\"preview__toolbarRight\">\r\n        <TextFieldsIcon />\r\n        <CreateIcon />\r\n        <NoteIcon />\r\n        <MusicNoteIcon />\r\n        <AttachFileIcon />\r\n        <CropIcon />\r\n        <TimerIcon />\r\n      </div>\r\n      <img src={cameraImage} alt=\"\" />\r\n      <div onClick={sendPost} className=\"preview__footer\">\r\n        <h2>Envoyer</h2>\r\n        <SendIcon className=\"preview__sendIcon\" />\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default Preview;\r\n"]},"metadata":{},"sourceType":"module"}